--- RCPTT testcase ---
Format-Version: 1.0
Contexts: _OCxtEBRGEeWWV9IuysVI_A,_lEyEsIMWEeW3Y6KfPyHe6A,_2Q6oEPOSEeaWpbE3jg39cA,_jcbUQGu1Eeeps9cepQRw2Q
Element-Name: StepReturnFromNestedResource
Element-Type: testcase
Element-Version: 3.0
External-Reference: 
Id: _SdNGkIMLEeW3Y6KfPyHe6A
Runtime-Version: 2.1.0.201606221726
Save-Time: 8/7/17 2:32 PM
Tags: Debug
Testcase-Type: ecl

------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac
Content-Type: text/ecl
Entry-Name: .content

//open all files
with [get-view "Project Explorer" | get-tree] {
    select "ScriptWithResource/Tests/TestWithNestedResources.robot" 
        | select "ScriptWithResource/Tests/TestWithNestedResources.robot" | double-click
    select "ScriptWithResource/Tests/Resources/res1.robot" | select "ScriptWithResource/Tests/Resources/res1.robot" 
        | double-click
    select "ScriptWithResource/Tests/Resources/res2.robot" | select "ScriptWithResource/Tests/Resources/res2.robot" 
        | double-click
}

//set breakpoint
get-tab-folder -index 1 | get-tab-item "TestWithNestedResources.robot" | click
get-editor "TestWithNestedResources.robot" | get-left-ruler | get-ruler-column AnnotationColumn | double-click-ruler 6

//run test
exec-with-options -disableJobWaiting -command {
	get-view "Project Explorer" | get-tree | select "ScriptWithResource/Tests/TestWithNestedResources.robot" 
	    | get-menu "Debug As/1 Robot Test" | click
	
	wait 2000    
	wait-for-specific-nr-of-threads -nr_items_in_thread 4

	with [get-button "Step Into (F5)"] {
	    click
	    wait-for-specific-nr-of-threads -nr_items_in_thread 2
	    click
	}
	wait-for-specific-nr-of-threads -nr_items_in_thread 3
	// debug is on res2.robot
	with [get-tab-folder -index 2] {
	    get-property "pages[0]" | equals "TestWithNestedResources.robot" | verify-true
	    get-property "pages[1]" | equals "res1.robot" | verify-true
	    get-property "pages[2]" | equals "res2.robot" | verify-true
	    get-property activePage | equals "res2.robot" | verify-true
	    get-property tabCount | equals 3 | verify-true
	}
	get-editor "res2.robot" | get-text-viewer | get-property text | equals "*** Keywords ***\n"
	    + "res 2\n"
	    + "    Log  This is res 2\n"
	    + "    [Return]    4" | verify-true
	check-debug-marker-on-ruler -line 3 -script_name "res2.robot"
	
	//check thread
	with [get-view Debug | get-tree] {
		    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" | get-property childCount 
		        | equals 3 | verify-true
		    wait 1500
		    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
		        | get-property "getItems().TreeItem[0].getText()" | equals "BuiltIn.Log [line:3]" | verify-true
		        
		    //difference in Robot versions
		    if [$robot_version | matches "^Robot Framework 2\.8\.\d .*"] {
			    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
			        | get-property "getItems().TreeItem[1].getText()" | equals "${re1_val} = res2.res 2 [line:6]"   | verify-true
		    	
		    }-else{
		   		get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
		        	| get-property "getItems().TreeItem[1].getText()" | equals "res2.res 2 [line:6]" | verify-true
		    }   
    
		    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
	        	| get-property "getItems().TreeItem[2].getText()" | equals "res1.res 1 [line:6]" | verify-true
	}

	//return to res1.robot    
	get-button "Step Return (F7)" | click
	wait 1000
	get-editor "res1.robot" | get-text-viewer | get-property text | equals "*** Settings ***\n"
	    + "Resource   res2.robot\n\n"
	    + "*** Keywords ***\n"
	    + "res 1\n"
	    + "    ${re1_val} =  res 2\n"
	    + "    Log  ${re1_val}" | verify-true
	check-debug-marker-on-ruler -line 7 -script_name "res1.robot"
	
	//check tread
	with [get-view Debug | get-tree] {
	    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" | get-property childCount 
	        | equals 2 | verify-true
	    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
	        | get-property "getItems().TreeItem[0].getText()" | equals "BuiltIn.Log [line:7]" | verify-true
	    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
	        | get-property "getItems().TreeItem[1].getText()" | equals "res1.res 1 [line:6]" | verify-true
	}
	
	//return to main script
	get-button "Step Return (F7)" | click
	wait 1000
	get-editor "TestWithNestedResources.robot" | get-text-viewer | get-property text | equals "*** Settings ***\n"
	    + "Resource    Resources/res1.robot\n\n"
	    + "*** Test Cases ***\n"
	    + "test with resource\n"
	    + "    res 1\n"
	    + "    Should End With   This is text   text" | verify-true
	check-debug-marker-on-ruler -line 7 -script_name "TestWithNestedResources.robot"
	
	//check tread
	with [get-view Debug | get-tree] {
	    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" | get-property childCount 
	        | equals 1 | verify-true
	    get-item "TestWithNestedResources.robot \\[Robot\\]/Robot Test at 127.0.0.1:\d{1,5}/Thread \\[main\\]" 
	        | get-property "getItems().TreeItem[0].getText()" | equals "BuiltIn.Should End With [line:7]" | verify-true
	}
	
	get-button "Resume (F8)" | click
	
}
------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac--
